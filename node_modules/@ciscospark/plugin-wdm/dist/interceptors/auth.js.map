{"version":3,"sources":["../../src/interceptors/auth.js"],"names":["DeviceAuthInterceptor","options","uri","includes","spark","config","credentials","tokenUrl","oauth","resolve","authorizeUrl","samlUrl","hydraServiceUrl","device","isSpecificService","then","isHydra","service","isService","isServiceUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA;;;;AAEA;;;IAGqBA,qB;;;;;;;;;;;;AASnB;AACA;AACA;AACA;;;;wCAIoBC,O,EAAS;AAAA;;AAC3B,UAAIA,QAAQC,GAAR,CAAYC,QAAZ,CAAqB,KAAKC,KAAL,CAAWC,MAAX,CAAkBC,WAAlB,CAA8BC,QAA9B,IAA0C,KAAKH,KAAL,CAAWC,MAAX,CAAkBC,WAAlB,CAA8BE,KAA9B,CAAoCD,QAAnG,CAAJ,EAAkH;AAChH,eAAO,kBAAQE,OAAR,CAAgB,KAAhB,CAAP;AACD;;AAED,UAAIR,QAAQC,GAAR,CAAYC,QAAZ,CAAqB,KAAKC,KAAL,CAAWC,MAAX,CAAkBC,WAAlB,CAA8BI,YAA9B,IAA8C,KAAKN,KAAL,CAAWC,MAAX,CAAkBC,WAAlB,CAA8BE,KAA9B,CAAoCE,YAAvG,CAAJ,EAA0H;AACxH,eAAO,kBAAQD,OAAR,CAAgB,KAAhB,CAAP;AACD;;AAED,UAAIR,QAAQC,GAAR,CAAYC,QAAZ,CAAqB,KAAKC,KAAL,CAAWC,MAAX,CAAkBC,WAAlB,CAA8BK,OAAnD,CAAJ,EAAiE;AAC/D,eAAO,kBAAQF,OAAR,CAAgB,KAAhB,CAAP;AACD;;AAED,UAAIR,QAAQC,GAAR,CAAYC,QAAZ,CAAqB,KAAKC,KAAL,CAAWC,MAAX,CAAkBO,eAAvC,CAAJ,EAA6D;AAC3D,eAAO,kBAAQH,OAAR,CAAgB,IAAhB,CAAP;AACD;;AAED,aAAO,KAAKL,KAAL,CAAWS,MAAX,CAAkBC,iBAAlB,UAA6Cb,QAAQC,GAArD,EACJa,IADI,CACC,UAACC,OAAD,EAAa;AACjB,YAAIA,OAAJ,EAAa;AACX,iBAAO,IAAP;AACD;;AAED,YAAIf,QAAQgB,OAAZ,EAAqB;AACnB,iBAAO,OAAKb,KAAL,CAAWS,MAAX,CAAkBK,SAAlB,CAA4BjB,QAAQgB,OAApC,CAAP;AACD;;AAED,YAAIhB,QAAQC,GAAZ,EAAiB;AACf,iBAAO,OAAKE,KAAL,CAAWS,MAAX,CAAkBM,YAAlB,CAA+BlB,QAAQC,GAAvC,CAAP;AACD;;AAED,eAAO,kBAAQO,OAAR,CAAgB,KAAhB,CAAP;AACD,OAfI,CAAP;AAgBD;AACD;;;;;AAjDA;;;6BAGgB;AACd;AACA,aAAO,IAAIT,qBAAJ,CAA0B,EAACI,OAAO,IAAR,EAA1B,CAAP;AACD;;;+BAjBH;;;;;kBAUqBJ,qB","file":"auth.js","sourcesContent":["/**!\n *\n * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {AuthInterceptor} from '@ciscospark/spark-core';\n\n/**\n * @class\n */\nexport default class DeviceAuthInterceptor extends AuthInterceptor {\n  /**\n   * @returns {DeviceAuthInterceptor}\n   */\n  static create() {\n    /* eslint no-invalid-this: [0] */\n    return new DeviceAuthInterceptor({spark: this});\n  }\n\n  // it's an if-tree, splitting it up into more functions makes it more\n  // difficult to interpet, not less\n  /* eslint-disable complexity */\n  /**\n   * @param {Object} options\n   * @returns {Promise<boolean>}\n   */\n  requiresCredentials(options) {\n    if (options.uri.includes(this.spark.config.credentials.tokenUrl || this.spark.config.credentials.oauth.tokenUrl)) {\n      return Promise.resolve(false);\n    }\n\n    if (options.uri.includes(this.spark.config.credentials.authorizeUrl || this.spark.config.credentials.oauth.authorizeUrl)) {\n      return Promise.resolve(false);\n    }\n\n    if (options.uri.includes(this.spark.config.credentials.samlUrl)) {\n      return Promise.resolve(false);\n    }\n\n    if (options.uri.includes(this.spark.config.hydraServiceUrl)) {\n      return Promise.resolve(true);\n    }\n\n    return this.spark.device.isSpecificService(`hydra`, options.uri)\n      .then((isHydra) => {\n        if (isHydra) {\n          return true;\n        }\n\n        if (options.service) {\n          return this.spark.device.isService(options.service);\n        }\n\n        if (options.uri) {\n          return this.spark.device.isServiceUrl(options.uri);\n        }\n\n        return Promise.resolve(false);\n      });\n  }\n  /* eslint-enable complexity */\n}\n"]}